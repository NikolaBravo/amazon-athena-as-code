{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "This AWS CloudFormation template Create/Update sample usage of Amazon Athena as Code service",
  "Parameters": {
    "Bucket": {
      "Type": "String",
      "AllowedPattern": "^s3://.*/$",
      "Description": "Specifies the location of the underlying data in Amazon S3 Bucket"
    }
  },
  "Resources": {
    "NamedQuery": {
      "Type": "Custom::AthenaNamedQuery",
      "Properties": {
        "ServiceToken": {
          "Fn::ImportValue": "A3CServiceToken"
        },
        "Name": "MyFirstQuery",
        "Description": "This simple query.",
        "Database": {
          "Ref": "Database"
        },
        "Query": {
          "QueryString": {
            "Fn::Join": [
              " ",
              [
                "SELECT * FROM",
                {
                  "Ref": "Table"
                }
              ]
            ]
          }
        }
      }
    },
    "Database": {
      "Type": "Custom::AthenaDatabase",
      "Properties": {
        "ServiceToken": {
          "Fn::ImportValue": "A3CServiceToken"
        },
        "Name": "My_DataBase_Name",
        "Comment": "This is a database comment.",
        "Location": {
          "Ref": "Bucket"
        },
        "Properties": [
          {
            "Name": "Key1",
            "Value": "Value2"
          },
          {
            "Name": "Key2",
            "Value": "Value1"
          }
        ]
      }
    },
    "Table": {
      "DependsOn": "Database",
      "Type": "Custom::AthenaTable",
      "Properties": {
        "ServiceToken": {
          "Fn::ImportValue": "A3CServiceToken"
        },
        "Name": "MyTableName",
        "Database": {
          "Ref": "Database"
        },
        "Schema": [
          {
            "Name": "Column1",
            "Type": "STRING",
            "Comment": "Comment #1"
          },
          {
            "Name": "Column2",
            "Type": "ARRAY<STRING>"
          },
          {
            "Name": "Column3",
            "Type": "TIMESTAMP",
            "Comment": "Comment #2"
          }
        ],
        "Comment": "This is the Table Comment.",
        "Partition": [
          {
            "Name": "Partition1",
            "Type": "TIMESTAMP"
          },
          {
            "Name": "Partition2",
            "Type": "STRING",
            "Comment": "Comment #3"
          }
        ],
        "RowFormat": {
          "SerDe": "org.openx.data.jsonserde.JsonSerDe",
          "Properties": [
            {
              "Name": "serialization.format",
              "Value": "1"
            }
          ]
        },
        "StoredAs": "TEXTFILE",
        "Location": {
          "Ref": "Bucket"
        },
        "Properties": [
          {
            "Name": "has_encrypted_data",
            "Value": "false"
          },
          {
            "Name": "Key1",
            "Value": "Value2"
          }
        ]
      }
    }
  }
}