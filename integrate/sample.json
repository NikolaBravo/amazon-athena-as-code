{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "This CloudFormation format show sample usage of Amazon Athena as Code",
  "Parameters": {
    "Bucket": {
      "Type": "String"
    }
  },
  "Resources": {
    "NamedQuery": {
      "Type": "Custom::AthenaNamedQuery",
      "Properties": {
        "ServiceToken": {
          "Fn::Sub": "arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:test-cf2"
        },
        "Name": "MyFirstQuery",
        "Description": "This simple query.",
        "Database": {
          "Ref": "Database"
        },
        "Query": {
          "QueryString": {
            "Fn::Join": [
              " ",
              [
                "SELECT * FROM",
                {
                  "Ref": "Table"
                }
              ]
            ]
          }
        }
      }
    },
    "Database": {
      "Type": "Custom::AthenaDatabase",
      "Properties": {
        "ServiceToken": {
          "Fn::Sub": "arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:test-cf2"
        },
        "Name": "My_DataBase_Name",
        "Location": {
          "Ref": "Bucket"
        },
        "Properties": [
          {
            "Name": "Key1",
            "Value": "Value2"
          },
          {
            "Name": "Key2",
            "Value": "Value1"
          }
        ]
      }
    },
    "Table": {
      "DependsOn": "Database",
      "Type": "Custom::AthenaExternalTable",
      "Properties": {
        "ServiceToken": {
          "Fn::Sub": "arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:test-cf2"
        },
        "Name": "MyTableName",
        "Database": {
          "Ref": "Database"
        },
        "Schema": [
          {
            "Name": "Column1",
            "DataType": "STRING",
            "Comment": "Comment #1"
          },
          {
            "Name": "Column2",
            "DataType": "ARRAY<STRING>"
          },
          {
            "Name": "Column3",
            "DataType": "TIMESTAMP",
            "Comment": "Comment #2"
          }
        ],
        "Comment": "This is the Table Comment.",
        "Partition": [
          {
            "Name": "Partition1",
            "DataType": "TIMESTAMP"
          },
          {
            "Name": "Partition2",
            "DataType": "STRING",
            "Comment": "Comment #3"
          }
        ],
        "SerDe": {
          "RowFormat": "org.openx.data.jsonserde.JsonSerDe",
          "StoredAs": "TEXTFILE",
          "Properties": [
            {
              "Name": "serialization.format",
              "Value": "1"
            }
          ]
        },
        "Location": {
          "Ref": "Bucket"
        },
        "Properties": [
          {
            "Name": "has_encrypted_data",
            "Value": "false"
          },
          {
            "Name": "Key1",
            "Value": "Value2"
          }
        ]
      }
    }
  }
}